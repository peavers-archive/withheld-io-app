<div *ngIf="challenge" class="section">
  <div class="container">
    <div class="columns">
      <div class="column is-narrow">
        <app-user-picture
          [large]="true"
          [name]="challenge.author.name"
          [pictureUrl]="challenge.author.avatarUrl"
        ></app-user-picture>
      </div>

      <div class="column is-10">
        <h1 class="title">{{ challenge.author.name }}</h1>

        <p class="imported-date">
          <span *ngIf="challenge.level && challenge.position">{{ challenge.level }} {{ challenge.position }},</span>
          {{ challenge.repository.name }}, added {{ challenge.created | amTimeAgo }}
        </p>
      </div>
    </div>

    <ul class="action-bar">
      <li class="action">
        <a [matMenuTriggerFor]="clone" mat-button>
          <mat-icon>get_app</mat-icon>
          Clone
        </a>
      </li>

      <mat-menu #clone="matMenu">
        <ng-template matMenuContent>
          <button mat-menu-item (click)="copyToClip(challenge.repository.sshUrl)">
            Use SSH
          </button>
          <button mat-menu-item (click)="copyToClip(challenge.repository.htmlUrl)">
            Use HTTPS
          </button>
        </ng-template>
      </mat-menu>

      <li class="action">
        <a href="{{ challenge.repository.htmlUrl }}" mat-button target="_blank">
          <mat-icon>code</mat-icon>
          See on GitHub
        </a>
      </li>

      <li *ngIf="challenge.lever" class="action">
        <a href="{{ challenge.lever }}" mat-button target="_blank">
          <mat-icon>link</mat-icon>
          See on Lever
        </a>
      </li>

      <li (click)="deleteChallenge(challenge)" class="action">
        <button mat-button>
          <mat-icon>delete_forever</mat-icon>
          Delete
        </button>
      </li>

      <!--      <li class="action">-->
      <!--        <a (click)="feedback()" color="primary" mat-raised-button>-->
      <!--          <i class="fa fa-comments"></i>-->
      <!--          Feedback-->
      <!--        </a>-->
      <!--      </li>-->
    </ul>

    <div class="columns is-multiline" *ngIf="codeFileObservable | async as codeFiles">
      <div class="column is-12 contents">
        <table class="table">
          <tr *ngFor="let codeFile of codeFiles">
            <td>
              <a [href]="'#' + codeFile.id" pageScroll pageScrollDuration="0" pageScrollOffset="70">
                {{ codeFile.location }}
              </a>
            </td>

            <td class="is-vertical-center">
              <div *ngFor="let author of uniqueCommentAuthor(codeFile)" class="is-pulled-right is-vertical-center">
                <app-user-picture [name]="author.name" [pictureUrl]="author.avatarUrl"></app-user-picture>
              </div>
            </td>
          </tr>
        </table>
      </div>

      <div *ngFor="let codeFile of codeFiles">
        <app-code-file-component [codeFile]="codeFile"></app-code-file-component>
      </div>
    </div>
  </div>
</div>

<app-scroll-to-top></app-scroll-to-top>
